<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MWZ • Teleportal Finder</title>
<link rel="icon" href="Plaguesmwzserver.png" />
<style>
  :root{
    --bg:#0b0f17; --panel:#101726; --muted:#9fb1d0; --text:#e6eefc; --ring:#334267;
    --t1:#2a6ae3; --t2:#e39b2a; --t3:#e33a2a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0b0f17 0%, #0e1422 100%);color:var(--text);
       font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  header{position:sticky;top:0;z-index:3;background:#0b0f17e6;border-bottom:1px solid #1c2740}
  .wrap{max-width:1100px;margin:0 auto;padding:18px}
  .brand{display:flex;align-items:center;gap:14px}
  .brand img{height:56px;border-radius:12px}
  h1{margin:0;font-size:1.45rem;letter-spacing:.2px}
  .sub{color:var(--muted);font-size:.92rem}
  main{max-width:1100px;margin:20px auto;padding:0 18px}
  .card{background:#101726;border:1px solid #1b2742;border-radius:16px;padding:16px}
  .row{display:grid;grid-template-columns:repeat(4,minmax(120px,1fr));gap:10px;margin:10px 0 12px}
  select,input,button{background:#0f1628;border:1px solid var(--ring);color:var(--text);
                      padding:.65rem .7rem;border-radius:10px}
  button{cursor:pointer}
  .results{margin-top:12px}
  table{width:100%;border-collapse:separate;border-spacing:0 8px;table-layout:fixed}
  th,td{text-align:left;padding:10px 12px;vertical-align:middle;word-wrap:break-word}
  thead th{color:#c9d9fb}
  tbody tr{background:#101726;border:1px solid #1b2742}
  tbody td{border-top:1px solid #1b2742;border-bottom:1px solid #1b2742}
  tbody td:first-child{border-left:1px solid #1b2742;border-top-left-radius:10px;border-bottom-left-radius:10px}
  tbody td:last-child{border-right:1px solid #1b2742;border-top-right-radius:10px;border-bottom-right-radius:10px}
  thead th:nth-child(1){width:180px}
  thead th:nth-child(2){width:80px}
  thead th:nth-child(3){width:120px}
  thead th:nth-child(4){width:120px}
  .pill{background:#152038;border:1px solid #213257;color:#bcd3ff;border-radius:999px;padding:3px 8px;font-size:.75rem}
  .pill.t1{background:rgba(42,106,227,.15);border-color:rgba(42,106,227,.5);color:#cfe0ff}
  .pill.t2{background:rgba(227,155,42,.15);border-color:rgba(227,155,42,.5);color:#ffe3bf}
  .pill.t3{background:rgba(227,58,42,.15); border-color:rgba(227,58,42,.5); color:#ffd0cb}
  .hint{color:#89a1ca;font-size:.9rem;margin-top:10px}
  .note-wrap{display:flex;align-items:center;gap:8px;min-height:84px}
  .noteimg{width:120px;height:84px;object-fit:cover;border-radius:8px;cursor:pointer}
  .msg{margin-top:6px;color:#ffb4b4;font-size:.9rem;min-height:1.2em}
  /* Lightbox */
  #imgModal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.7);z-index:50}
  #imgModal.open{display:grid}
  /* ⬇️ Force a big display in the lightbox, even if the source is a small thumbnail */
  #imgModal img{
    width:min(90vw, 1200px);
    height:auto;
    max-height:90vh;
    border-radius:12px;
    box-shadow:0 20px 60px rgba(0,0,0,.5);
  }
  #imgModal .close{
    position:absolute;top:12px;right:14px;background:#0f1628;color:#e6eefc;
    border:1px solid #334267;padding:.45rem .65rem;border-radius:10px;cursor:pointer
  }
  .discord{margin-top:40px;text-align:center}
.discord-card{
  display:flex;align-items:center;gap:18px;justify-content:center;
  background:#101726;border:1px solid #1b2742;border-radius:16px;
  padding:20px;max-width:700px;margin:0 auto;box-shadow:0 8px 20px rgba(0,0,0,.25)
}
.discord-logo{height:72px;width:72px;border-radius:12px}
.discord-btn{
  display:inline-block;margin-top:10px;padding:10px 18px;
  background:#5865F2;color:#fff;text-decoration:none;font-weight:600;
  border-radius:8px;transition:background .2s
}
.discord-btn:hover{background:#4752c4}
.back-home{text-align:center;margin:30px 0}
.back-btn{
  display:inline-block;padding:10px 18px;
  background:#101726;border:1px solid var(--ring);border-radius:8px;
  text-decoration:none;color:var(--text);font-weight:600;
  transition:.2s
}
.back-btn:hover{background:#16233d;border-color:var(--accent);color:var(--accent)}

</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">
      <img src="Plaguesmwzserver.png" alt="Plague's MWZ Server">
      <div>
        <h1>MWZ • Teleportal Finder</h1>
        <div class="sub">Enter your grid (e.g., <strong>F4</strong>). I’ll return the nearest Teleportal entry and auto-color its zone (T1/T2/T3).</div>
      </div>
    </div>
  </div>
</header>
<section class="discord">
  <div class="discord-card">
    <img src="Plaguesmwzserver.png" alt="Plague's MWZ Server" class="discord-logo">
    <div>
      <h2>Join the Community</h2>
      <p>Hop into <strong>Plague's MWZ Server</strong> on Discord to squad up, share tips, and stay updated.</p>
      <a href="http://join.plaguesmwzserver.com" target="_blank" rel="noopener" class="discord-btn">Join Discord</a>
    </div>
  </div>
</section>

<main>
  <div class="card">
    <div class="row">
      <div>
        <label for="grid"><small>Where are you?</small></label><br>
        <input id="grid" placeholder="e.g., F4" maxlength="3" />
        <div id="msg" class="msg"></div>
      </div>
      <div>
        <label for="zone"><small>Zone filter (optional)</small></label><br>
        <select id="zone">
          <option value="">Any</option>
          <option value="t1">White (T1)</option>
          <option value="t2">Orange (T2)</option>
          <option value="t3">Red (T3)</option>
        </select>
      </div>
      <div>
        <label for="limit"><small>Show top</small></label><br>
        <select id="limit">
          <option>1</option><option selected>3</option><option>5</option><option>10</option>
        </select>
      </div>
      <div style="align-self:end;display:flex;gap:8px;">
        <button id="findBtn">Find nearest</button>
        <button id="listAllBtn" title="Ignore your grid; just list all portals">List all</button>
      </div>
    </div>

    <div class="results">
      <table>
        <thead><tr><th>Portal</th><th>Grid</th><th>Zone</th><th>Distance</th><th>Notes / Image</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
      <div class="hint">Drop thumbnails into <code>/images/portals/</code>. Without an image, a neutral placeholder will show instead.</div>
    </div>
  </div>
</main>

<!-- Lightbox -->
<div id="imgModal" aria-hidden="true">
  <button class="close" aria-label="Close image (Esc)">Close</button>
  <img id="imgModalPic" alt="">
</div>

<script>
/* --------------------- Portals --------------------- */
const PORTALS = [
  {name:'Portal B2', grid:'B2', notes:'Harbor side', img:'images/portals/b2_thumb.png', imgFull:'images/portals/b2_full.png'},
  {name:'Portal C2', grid:'C2', notes:'', img:'images/portals/c2_thumb.png', imgFull:'images/portals/c2_full.png'},
  {name:'Portal D1', grid:'D1', notes:'Inside Tunnel, Halfway along', img:'images/portals/d1_thumb.png', imgFull:'images/portals/d1_full.png'},
  {name:'Portal F3', grid:'F3', notes:'', img:'images/portals/f3_thumb.png', imgFull:'images/portals/f3_full.png'},
  {name:'Portal G4', grid:'G4', notes:'', img:'images/portals/g4_thumb.png', imgFull:'images/portals/g4_full.png'},
  {name:'Portal E5', grid:'E5', notes:'', img:'images/portals/e5_thumb.png', imgFull:'images/portals/e5_full.png'},
  {name:'Portal F6', grid:'F6', notes:'', img:'images/portals/f6_thumb.png', imgFull:'images/portals/f6_full.png'},
  {name:'Portal G6', grid:'G6', notes:'', img:'images/portals/g6_thumb.png', imgFull:'images/portals/g6_full.png'},
  {name:'Portal C3', grid:'C3', notes:'', img:'images/portals/c3_thumb.png', imgFull:'images/portals/c3_full.png'},
  {name:'Portal B4', grid:'B4', notes:'', img:'images/portals/b4_thumb.png', imgFull:'images/portals/b4_full.png'},
  {name:'Portal C6', grid:'C6', notes:'', img:'images/portals/c6_thumb.png', imgFull:'images/portals/c6_full.png'},
  {name:'Portal F8', grid:'F8', notes:'', img:'images/portals/f8_thumb.png', imgFull:'images/portals/f8_full.png'},
  {name:'Portal H8', grid:'H8', notes:'', img:'images/portals/h8_thumb.png', imgFull:'images/portals/h8_full.png'},
  {name:'Portal I2', grid:'I2', notes:'', img:'images/portals/i2_thumb.png', imgFull:'images/portals/i2_full.png'},
  {name:'Portal H3', grid:'H3', notes:'', img:'images/portals/h3_thumb.png', imgFull:'images/portals/h3_full.png'},
  {name:'Portal H5', grid:'H5', notes:'', img:'images/portals/h5_thumb.png', imgFull:'images/portals/h5_full.png'}
];

/* --------- Zone auto-labelling ---------- */
const RED_MAP = new Set(['F4','F5','F6','G4','G5','G6','E5']);
const ORANGE_MAP = new Set(['E4','E6','D4','D5','D6','F3','G3','H4','H5','H6','G7','F7','E7']);
function zoneOf(cell){
  if(RED_MAP.has(cell))    return {key:'t3', label:'Red (T3)'};
  if(ORANGE_MAP.has(cell)) return {key:'t2', label:'Orange (T2)'};
  return {key:'t1', label:'White (T1)'};
}

/* ---------------- Helpers ---------------- */
const letters = 'ABCDEFGHIJ';
function parseGrid(s){
  if(!s) return null;
  s = s.trim().toUpperCase();
  const m = s.match(/^([A-J])\s*-?\s*(10|[1-9])$/);
  if(!m) return null;
  return {col: letters.indexOf(m[1]), row: parseInt(m[2],10)-1, label:`${m[1]}${m[2]}`};
}
function dist(a,b){ return Math.abs(a.col-b.col)+Math.abs(a.row-b.row); }
function byNearest(from,zoneFilterKey){
  return PORTALS
    .map(p => {
      const pg = parseGrid(p.grid);
      if(!pg) return null;
      const z  = zoneOf(pg.label);
      return {...p, zone:z, d: dist(from, pg)};
    })
    .filter(Boolean)
    .filter(p => !zoneFilterKey || p.zone.key===zoneFilterKey)
    .sort((a,b)=>a.d-b.d);
}

/* ---------------- Render ---------------- */
function renderRows(rows){
  const tbody = document.getElementById('tbody');
  tbody.innerHTML = '';
  const placeholder = 'data:image/svg+xml;utf8,'+encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="120" height="84">'+
    '<rect width="100%" height="100%" fill="#0f1628"/>'+
    '<text x="50%" y="50%" font-size="14" fill="#8899bb" font-family="Arial" text-anchor="middle" dominant-baseline="middle">No Image</text>'+
    '</svg>'
  );
  rows.forEach(r=>{
    const thumb = r.img || placeholder;
    const full  = r.imgFull || r.img || placeholder;
    const tr = document.createElement('tr');

    // Build notes cell with fixed-size thumb
    const wrap = document.createElement('div');
    wrap.className = 'note-wrap';
    const text = document.createElement('div');
    text.textContent = r.notes || '';
    const img = document.createElement('img');
    img.className = 'noteimg';
    img.alt = r.name;
    img.width = 120; img.height = 84; img.loading = 'lazy';
    img.src = thumb;
    img.setAttribute('data-full', full);
    img.onerror = ()=>{ img.src = placeholder; };

    wrap.appendChild(text);
    wrap.appendChild(img);

    tr.innerHTML =
      `<td><strong>${r.name}</strong></td>`+
      `<td><span class="pill">${r.grid}</span></td>`+
      `<td><span class="pill ${r.zone.key}">${r.zone.label}</span></td>`+
      `<td>${typeof r.d==='number'? r.d+' grid steps':'—'}</td>`;
    const td = document.createElement('td');
    td.appendChild(wrap);
    tr.appendChild(td);
    tbody.appendChild(tr);
  });
  if(rows.length===0){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td colspan="5">No portals match those filters.</td>`;
    tbody.appendChild(tr);
  }
}

/* ---------------- UI wiring ---------------- */
const input = document.getElementById('grid');
const zone  = document.getElementById('zone');
const limit = document.getElementById('limit');
const msg   = document.getElementById('msg');

document.getElementById('findBtn').addEventListener('click', ()=>{
  const g = parseGrid(input.value);
  if(!g){ msg.textContent = 'Enter a valid grid like F4 (A–J with 1–10).'; renderRows([]); return; }
  msg.textContent = '';
  const rows = byNearest(g, zone.value).slice(0, parseInt(limit.value,10));
  renderRows(rows);
});
document.getElementById('listAllBtn').addEventListener('click', ()=>{
  msg.textContent = '';
  const rows = byNearest({col:0,row:0}, zone.value).map(r=>({...r, d: undefined}));
  renderRows(rows);
});
renderRows([]);

/* ---------------- Lightbox ---------------- */
const modal = document.getElementById('imgModal');
const modalPic = document.getElementById('imgModalPic');
const modalClose = modal.querySelector('.close');

document.addEventListener('click', (e)=>{
  const el = e.target;
  if(el.classList && el.classList.contains('noteimg')){
    const full = el.getAttribute('data-full') || el.src;
    modalPic.src = full;
    modalPic.alt = el.alt || '';
    modal.classList.add('open');
    modal.setAttribute('aria-hidden','false');
  } else if(el === modal || el === modalClose){
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden','true');
    modalPic.src = '';
  }
});
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape' && modal.classList.contains('open')){
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden','true');
    modalPic.src = '';
  }
});
</script>
<div class="back-home">
  <a href="index.html" class="back-btn">⬅ Back to Home</a>
</div>

</body>
</html>
